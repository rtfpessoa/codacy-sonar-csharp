When using [ReaderWriterLock](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlock) and [ReaderWriterLockSlim](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim) for managing read and write locks,
you should not release a read lock while holding a write lock and vice versa, otherwise you might have runtime exceptions. The locks should be always
correctly paired so that the shared resource is accessed safely.

This rule raises if:

- you call [ReaderWriterLock.AcquireWriterLock](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlock.acquirewriterlock) or [ReaderWriterLock.UpgradeToWriterLock](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlock.upgradetowriterlock)
  and then use [ReaderWriterLock.ReleaseReaderLock](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlock.releasereaderlock)
- you call [ReaderWriterLockSlim.EnterWriteLock](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim.enterwritelock) or
  [ReaderWriterLockSlim.TryEnterWriteLock](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim.tryenterwritelock) and then use [ReaderWriterLockSlim.ExitReadLock](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim.exitreadlock)
- you call [ReaderWriterLock.AcquireReaderLock](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlock.acquirereaderlock) or [ReaderWriterLock.DowngradeFromWriterLock](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlock.downgradefromwriterlock) and then use [ReaderWriterLock.ReleaseWriterLock](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlock.releasewriterlock)
- or you call [ReaderWriterLockSlim.EnterReadLock](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim.enterreadlock), [ReaderWriterLockSlim.TryEnterReadLock](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim.tryenterreadlock), [ReaderWriterLockSlim.EnterUpgradeableReadLock](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim.enterupgradeablereadlock) or [ReaderWriterLockSlim.TryEnterUpgradeableReadLock](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim.tryenterupgradeablereadlock) and then use [ReaderWriterLockSlim.ExitWriteLock](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim.exitwritelock)

## Why is this an issue?

If you use the `ReaderWriterLockSlim` class, you will get a [LockRecursionException](https://learn.microsoft.com/en-us/dotnet/api/system.threading.lockrecursionexception). In the case of
`ReaderWriterLock`, youâ€™ll get a runtime exception for trying to release a lock that is not owned by the calling thread.

### Code examples

#### Noncompliant code example

    public class Example
    {
        private static ReaderWriterLock rwLock = new();
    
        public void Writer()
        {
            rwLock.AcquireWriterLock(2000);
            try
            {
                // ...
            }
            finally
            {
                rwLock.ReleaseReaderLock(); // Noncompliant, will throw runtime exception
            }
        }
    
        public void Reader()
        {
            rwLock.AcquireReaderLock(2000);
            try
            {
                // ...
            }
            finally
            {
                rwLock.ReleaseWriterLock(); // Noncompliant, will throw runtime exception
            }
        }
    }

#### Compliant solution

    public class Example
    {
        private static ReaderWriterLock rwLock = new();
    
        public static void Writer()
        {
            rwLock.AcquireWriterLock(2000);
            try
            {
                // ...
            }
            finally
            {
                rwLock.ReleaseWriterLock();
            }
        }
    
        public static void Reader()
        {
            rwLock.AcquireReaderLock(2000);
            try
            {
                // ...
            }
            finally
            {
                rwLock.ReleaseReaderLock();
            }
        }
    }

## Resources

### Documentation

- Microsoft Learn - [ReaderWriterLock Class](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlock)
- Microsoft Learn - [ReaderWriterLockSlim](https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim)